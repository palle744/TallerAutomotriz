<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRM Taller Automotriz</title>
    <link rel="stylesheet" href="css/styles.css?v=2">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js'></script>
</head>

<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="logo">
                <h2>AutoFix CRM</h2>
                <button id="sidebar-close" class="mobile-only"
                    style="background:none; border:none; font-size:1.5rem; cursor:pointer;">&times;</button>
            </div>
            <nav class="nav-links">
                <a href="#" class="active" onclick="showSection('dashboard')">Dashboard</a>
                <a href="#" onclick="showSection('daily-entries')">Ingresos del Día</a>
                <a href="#" onclick="showSection('ingreso')">Nuevo Ingreso</a>
                <a href="#" onclick="showSection('revision')">Revisión</a>
                <a href="#" onclick="showSection('revision-history')">Historial Revisiones</a>
                <a href="#" onclick="showSection('calendar')">Calendario</a>
                <a href="#" onclick="showSection('estimates')">Presupuestos</a>
                <a href="#" onclick="showSection('status-view')">Estatus</a>
                <a href="#" onclick="showSection('laminado')">Laminado</a>
                <a href="#" onclick="showSection('pintura')">Pintura</a>
                <a href="#" onclick="showSection('salida-view')">Salida</a>
                <a href="#" onclick="showSection('pagos-view')" style="color: #10b981; font-weight: bold;">Pagos</a>
                <a href="#" onclick="showSection('reportes')">Reportes</a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="top-bar">
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <h1>Panel de Control</h1>
                </div>
                <div class="user-info" style="display: flex; align-items: center; gap: 1rem;">
                    <span>Admin User</span>
                    <button id="menu-toggle" class="btn-primary mobile-only" style="padding: 8px 12px;">☰</button>
                </div>
            </header>

            <!-- Dashboard Section -->
            <section id="dashboard" class="content-section">
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>En Taller</h3>
                        <p class="stat-number" id="total-vehicles">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>En Proceso</h3>
                        <p class="stat-number" id="in-process-vehicles">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Vehículos Revisados</h3>
                        <p class="stat-number" id="total-revisions-count">0</p>
                    </div>
                </div>

                <!-- Vehicles Table -->
                <div class="table-container" style="margin-bottom: 2rem;">
                    <h3>Vehículos Ingresados</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Placa</th>
                                <th>Modelo</th>
                                <th>Color</th>
                                <th>Status</th>
                                <th>Fecha Ingreso</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="vehicle-table-body">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>

                <!-- Revisions Table -->
                <div class="table-container">
                    <h3>Vehículos Revisados</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>ID Revisión</th>
                                <th>Placa</th>
                                <th>Marca/Modelo</th>
                                <th>Fecha Revisión</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="dashboard-revisions-body">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Daily Entries Section (Ingresos del Dia) -->
            <section id="daily-entries" class="content-section hidden">
                <div class="table-container">
                    <h3>Ingresos del Día</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>No. Orden</th>
                                <th>Usuario</th>
                                <th>Modelo</th>
                                <th>Año</th>
                                <th>Marca</th>
                                <th>Placas</th>
                            </tr>
                        </thead>
                        <tbody id="daily-table-body">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Ingreso Section -->
            <section id="ingreso" class="content-section hidden">
                <div class="form-container">
                    <h3>Registrar Nuevo Vehículo</h3>

                    <!-- Search Revision -->
                    <div class="search-box"
                        style="margin-bottom: 24px; padding-bottom: 24px; border-bottom: 1px solid #e2e8f0;">
                        <label for="search_revision_code"
                            style="display: block; margin-bottom: 8px; font-weight: 500; color: #1e293b;">Id de
                            revisión</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="search_revision_code"
                                placeholder="Ingresar Código de Revisión (ej: E01T1234)"
                                style="flex: 1; padding: 10px; border-radius: 8px; border: 1px solid #cbd5e1;">
                            <button type="button" id="btn-search-revision" class="btn-primary"
                                style="padding: 10px 20px;">Buscar</button>
                        </div>
                    </div>

                    <form id="ingreso-form">
                        <input type="hidden" id="ingreso_revision_id">
                        <div class="form-group">
                            <label for="plate">Placa</label>
                            <input type="text" id="plate" name="plate" required>
                        </div>
                        <div class="form-group">
                            <label for="brand">Marca</label>
                            <input type="text" id="brand" name="brand" placeholder="Ej: VW, Nissan..." required>
                        </div>
                        <div class="form-group">
                            <label for="model">Modelo</label>
                            <input type="text" id="model" name="model" placeholder="Ej: Jetta, Versa..." required>
                        </div>
                        <div class="form-group">
                            <label for="year">Año</label>
                            <input type="number" id="year" name="year" placeholder="Ej: 2023" required>
                        </div>
                        <div class="form-group">
                            <label for="color">Color</label>
                            <input type="text" id="color" name="color">
                        </div>
                        <div class="form-group">
                            <label for="kilometers">Kilometraje</label>
                            <input type="number" id="kilometers" name="kilometers" placeholder="Ej: 50000">
                        </div>
                        <div class="form-group">
                            <label for="serial_number">No. de Serie (VIN)</label>
                            <input type="text" id="serial_number" name="serial_number" placeholder="Ej: 3N1AB...">
                        </div>
                        <div class="form-group">
                            <label for="fuel_level">Nivel de Combustible</label>
                            <select id="fuel_level" name="fuel_level"
                                style="width: 100%; padding: 8px; border: 1px solid #cbd5e1; border-radius: 6px;">
                                <option value="">Seleccionar...</option>
                                <option value="Reserva">Reserva</option>
                                <option value="1/4">1/4</option>
                                <option value="1/2">1/2</option>
                                <option value="3/4">3/4</option>
                                <option value="Lleno">Lleno</option>
                            </select>
                        </div>

                        <!-- Customer Info -->
                        <div class="form-group">
                            <label for="owner_name">Nombre del Dueño</label>
                            <input type="text" id="owner_name" name="owner_name" required>
                        </div>
                        <div class="form-group">
                            <label for="contact_phone">Teléfono de Contacto</label>
                            <input type="tel" id="contact_phone" name="contact_phone" required>
                        </div>
                        <div class="form-group">
                            <label for="email">Correo Electrónico</label>
                            <input type="email" id="email" name="email" required>
                        </div>
                        <div class="form-group">
                            <label for="rfc">RFC (Opcional)</label>
                            <input type="text" id="rfc" name="rfc">
                        </div>

                        <!-- Insurance Toggle -->
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="is_insurance" name="is_insurance">
                                ¿Entra por Seguro?
                            </label>
                        </div>

                        <!-- Conditional Fields -->
                        <div id="insurance-fields" class="hidden">
                            <div class="form-group">
                                <label for="insurance_company">Compañía Aseguradora</label>
                                <input type="text" id="insurance_company" name="insurance_company"
                                    placeholder="Ej: Qualitas, AXA...">
                            </div>
                            <div class="form-group">
                                <label for="policy_number">No. de Póliza</label>
                                <input type="text" id="policy_number" name="policy_number" placeholder="Ej: 123456789">
                            </div>
                            <div class="form-group">
                                <label for="entry_reason">Motivo de Ingreso</label>
                                <textarea id="entry_reason" name="entry_reason" rows="3"
                                    placeholder="Descripción del siniestro o reparación..."></textarea>
                            </div>
                        </div>

                        <button type="submit" class="btn-primary">Registrar Vehículo</button>
                    </form>
                </div>
            </section>

            <!-- Revision History Section -->
            <section id="revision-history" class="content-section hidden">
                <div class="table-container">
                    <h3>Historial de Revisiones</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>ID Revisión</th>
                                <th>Placa</th>
                                <th>Marca/Modelo</th>
                                <th>Dueño</th>
                                <th>Fecha</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="revision-history-body">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Estimates Section -->
            <section id="estimates" class="content-section hidden">
                <div class="form-container">
                    <h3>Generar Presupuesto</h3>

                    <!-- Search Vehicle -->
                    <div class="search-box"
                        style="margin-bottom: 24px; padding-bottom: 24px; border-bottom: 1px solid #e2e8f0;">
                        <label for="search_estimate_code"
                            style="display: block; margin-bottom: 8px; font-weight: 500; color: #1e293b;">Buscar por ID
                            de Revisión</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="search_estimate_code" placeholder="Ej: E01T1234"
                                style="flex: 1; padding: 10px; border-radius: 8px; border: 1px solid #cbd5e1;">
                            <button type="button" id="btn-search-estimate" class="btn-primary"
                                style="padding: 10px 20px;">Buscar</button>
                        </div>
                    </div>

                    <!-- Car Info Viz -->
                    <div id="estimate-car-info" class="hidden"
                        style="background: #f1f5f9; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="margin-top: 0;">Detalles del Vehículo</h4>
                        <p><strong>Vehículo:</strong> <span id="est_brand_model"></span></p>
                        <p><strong>Dueño:</strong> <span id="est_owner"></span></p>
                        <input type="hidden" id="est_vehicle_id">
                    </div>

                    <!-- Categories -->
                    <div id="estimate-categories" class="hidden">



                        <!-- Pintura -->
                        <div class="estimate-category" data-category="pintura">
                            <h4 class="category-header" onclick="toggleCategory(this)"
                                style="cursor: pointer; background: #e2e8f0; padding: 10px; border-radius: 6px; margin: 10px 0; display: flex; justify-content: space-between; align-items: center;">
                                <span>
                                    <input type="checkbox" class="cat-enable-check"
                                        style="margin-right: 10px; transform: scale(1.2);"
                                        onclick="event.stopPropagation(); toggleCategoryStatus(this)">
                                    Pintura
                                </span>
                                <span>▼</span>
                            </h4>
                            <div class="category-content hidden"
                                style="padding: 10px; border: 1px solid #e2e8f0; border-top: none;">
                                <div class="form-group">
                                    <label>Descripción</label>
                                    <textarea class="est-desc" rows="2"></textarea>
                                </div>
                                <div class="form-group">
                                    <label>Monto</label>
                                    <input type="number" class="est-amount" oninput="calculateTotal()"
                                        placeholder="0.00">
                                </div>
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" class="est-has-parts" onchange="toggleParts(this)">
                                        ¿Requiere Piezas?
                                    </label>
                                </div>
                                <div class="form-group parts-field hidden">
                                    <label>Nombre de Piezas</label>
                                    <input type="text" class="est-parts-name">
                                </div>
                            </div>
                        </div>

                        <!-- Laminado -->
                        <div class="estimate-category" data-category="laminado">
                            <h4 class="category-header" onclick="toggleCategory(this)"
                                style="cursor: pointer; background: #e2e8f0; padding: 10px; border-radius: 6px; margin: 10px 0; display: flex; justify-content: space-between; align-items: center;">
                                <span>
                                    <input type="checkbox" class="cat-enable-check"
                                        style="margin-right: 10px; transform: scale(1.2);"
                                        onclick="event.stopPropagation(); toggleCategoryStatus(this)">
                                    Laminado
                                </span>
                                <span>▼</span>
                            </h4>
                            <div class="category-content hidden"
                                style="padding: 10px; border: 1px solid #e2e8f0; border-top: none;">
                                <div class="form-group">
                                    <label>Descripción</label>
                                    <textarea class="est-desc" rows="2"></textarea>
                                </div>
                                <div class="form-group">
                                    <label>Monto</label>
                                    <input type="number" class="est-amount" oninput="calculateTotal()"
                                        placeholder="0.00">
                                </div>
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" class="est-has-parts" onchange="toggleParts(this)">
                                        ¿Requiere Piezas?
                                    </label>
                                </div>
                                <div class="form-group parts-field hidden">
                                    <label>Nombre de Piezas</label>
                                    <input type="text" class="est-parts-name">
                                </div>
                            </div>
                        </div>

                        <!-- Cristales -->
                        <div class="estimate-category" data-category="cristales">
                            <h4 class="category-header" onclick="toggleCategory(this)"
                                style="cursor: pointer; background: #e2e8f0; padding: 10px; border-radius: 6px; margin: 10px 0; display: flex; justify-content: space-between; align-items: center;">
                                <span>
                                    <input type="checkbox" class="cat-enable-check"
                                        style="margin-right: 10px; transform: scale(1.2);"
                                        onclick="event.stopPropagation(); toggleCategoryStatus(this)">
                                    Cristales
                                </span>
                                <span>▼</span>
                            </h4>
                            <div class="category-content hidden"
                                style="padding: 10px; border: 1px solid #e2e8f0; border-top: none;">
                                <div class="form-group">
                                    <label>Descripción</label>
                                    <textarea class="est-desc" rows="2"></textarea>
                                </div>
                                <div class="form-group">
                                    <label>Monto</label>
                                    <input type="number" class="est-amount" oninput="calculateTotal()"
                                        placeholder="0.00">
                                </div>
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" class="est-has-parts" onchange="toggleParts(this)">
                                        ¿Requiere Piezas?
                                    </label>
                                </div>
                                <div class="form-group parts-field hidden">
                                    <label>Nombre de Piezas</label>
                                    <input type="text" class="est-parts-name">
                                </div>
                            </div>
                        </div>

                        <!-- Eléctrico -->
                        <div class="estimate-category" data-category="electrico">
                            <h4 class="category-header" onclick="toggleCategory(this)"
                                style="cursor: pointer; background: #e2e8f0; padding: 10px; border-radius: 6px; margin: 10px 0; display: flex; justify-content: space-between; align-items: center;">
                                <span>
                                    <input type="checkbox" class="cat-enable-check"
                                        style="margin-right: 10px; transform: scale(1.2);"
                                        onclick="event.stopPropagation(); toggleCategoryStatus(this)">
                                    Eléctrico
                                </span>
                                <span>▼</span>
                            </h4>
                            <div class="category-content hidden"
                                style="padding: 10px; border: 1px solid #e2e8f0; border-top: none;">
                                <div class="form-group">
                                    <label>Descripción</label>
                                    <textarea class="est-desc" rows="2"></textarea>
                                </div>
                                <div class="form-group">
                                    <label>Monto</label>
                                    <input type="number" class="est-amount" oninput="calculateTotal()"
                                        placeholder="0.00">
                                </div>
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" class="est-has-parts" onchange="toggleParts(this)">
                                        ¿Requiere Piezas?
                                    </label>
                                </div>
                                <div class="form-group parts-field hidden">
                                    <label>Nombre de Piezas</label>
                                    <input type="text" class="est-parts-name">
                                </div>
                            </div>
                        </div>

                        <!-- Motor -->
                        <div class="estimate-category" data-category="motor">
                            <h4 class="category-header" onclick="toggleCategory(this)"
                                style="cursor: pointer; background: #e2e8f0; padding: 10px; border-radius: 6px; margin: 10px 0; display: flex; justify-content: space-between; align-items: center;">
                                <span>
                                    <input type="checkbox" class="cat-enable-check"
                                        style="margin-right: 10px; transform: scale(1.2);"
                                        onclick="event.stopPropagation(); toggleCategoryStatus(this)">
                                    Motor
                                </span>
                                <span>▼</span>
                            </h4>
                            <div class="category-content hidden"
                                style="padding: 10px; border: 1px solid #e2e8f0; border-top: none;">
                                <div class="form-group">
                                    <label>Descripción</label>
                                    <textarea class="est-desc" rows="2"></textarea>
                                </div>
                                <div class="form-group">
                                    <label>Monto</label>
                                    <input type="number" class="est-amount" oninput="calculateTotal()"
                                        placeholder="0.00">
                                </div>
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" class="est-has-parts" onchange="toggleParts(this)">
                                        ¿Requiere Piezas?
                                    </label>
                                </div>
                                <div class="form-group parts-field hidden">
                                    <label>Nombre de Piezas</label>
                                    <input type="text" class="est-parts-name">
                                </div>
                            </div>
                        </div>

                        <!-- Extras -->
                        <div class="estimate-category" data-category="extras">
                            <h4 class="category-header" onclick="toggleCategory(this)"
                                style="cursor: pointer; background: #e2e8f0; padding: 10px; border-radius: 6px; margin: 10px 0; display: flex; justify-content: space-between; align-items: center;">
                                <span>
                                    <input type="checkbox" class="cat-enable-check"
                                        style="margin-right: 10px; transform: scale(1.2);"
                                        onclick="event.stopPropagation(); toggleCategoryStatus(this)">
                                    Extras
                                </span>
                                <span>▼</span>
                            </h4>
                            <div class="category-content hidden"
                                style="padding: 10px; border: 1px solid #e2e8f0; border-top: none;">
                                <div class="form-group">
                                    <label>Descripción</label>
                                    <textarea class="est-desc" rows="2"></textarea>
                                </div>
                                <div class="form-group">
                                    <label>Monto</label>
                                    <input type="number" class="est-amount" oninput="calculateTotal()"
                                        placeholder="0.00">
                                </div>
                                <div class="form-group">
                                    <label>
                                        <input type="checkbox" class="est-has-parts" onchange="toggleParts(this)">
                                        ¿Requiere Piezas?
                                    </label>
                                </div>
                                <div class="form-group parts-field hidden">
                                    <label>Nombre de Piezas</label>
                                    <input type="text" class="est-parts-name">
                                </div>
                            </div>
                        </div> <!-- End Extras -->
                    </div> <!-- End Estimate Categories -->

                    <div class="summary-section" style="margin-top: 32px; text-align: right;">
                        <div style="font-size: 1.5rem; font-weight: bold; color: #1e293b; margin-bottom: 16px;">
                            Total Estimado: $<span id="est-total-display">0.00</span>
                        </div>
                        <button type="button" id="btn-save-estimate" class="btn-primary"
                            style="padding: 12px 32px; font-size: 1.1rem;">
                            Guardar Presupuesto
                        </button>
                    </div>
                </div> <!-- End Form Container -->

                <!-- Estimates History Section -->
                <div class="wide-container" style="margin-top: 2rem;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3 style="margin: 0; color: #1e293b;">Historial de Presupuestos</h3>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="search-estimate-history" placeholder="Buscar por ID..."
                                style="padding: 8px 12px; border: 1px solid #cbd5e1; border-radius: 6px; width: 200px;">
                        </div>
                    </div>
                    <div class="table-container" style="padding: 0; box-shadow: none;">
                        <table class="history-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Fecha</th>
                                    <th>Vehículo</th>
                                    <th>Generado Por</th>
                                    <th>Total Estimado</th>
                                    <th>Monto Aprobado</th>
                                    <th>Notas Aprobación</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="estimates-history-body">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>

            </section>

            <!-- Calendar Section -->
            <section id="calendar" class="content-section hidden">
                <div class="wide-container" style="height: 100%;">
                    <h3 style="margin-bottom: 20px;">Agenda de Taller</h3>
                    <div id="calendar-el" style="height: 700px;"></div>
                </div>
            </section>

            <!-- STATUS VIEW -->
            <section id="status-view" class="content-section hidden">
                <div class="wide-container" style="max-width: 900px; margin: 0 auto;">
                    <h2 style="margin-bottom: 2rem;">Estatus de Reparación</h2>

                    <div class="card" style="padding: 2rem;">
                        <div class="search-bar" style="display: flex; gap: 1rem; margin-bottom: 0;">
                            <input type="text" id="status-search-input"
                                placeholder="Buscar por placa, modelo o cliente..."
                                style="flex:1; padding: 12px; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 1rem;">
                            <button class="btn-primary" onclick="performStatusSearch()"
                                style="padding: 0 2rem;">Buscar</button>
                        </div>
                    </div>

                    <div id="status-result-card" class="card hidden" style="margin-top: 2rem; padding: 2.5rem;">
                        <div
                            style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 3rem; border-bottom: 1px solid #e2e8f0; padding-bottom: 2rem;">
                            <div>
                                <h3 id="status-veh-title" style="margin: 0; font-size: 1.8rem; color: #1e293b;">-</h3>
                                <p id="status-veh-subtitle" style="margin: 8px 0 0; color: #64748b; font-size: 1.1rem;">
                                    -</p>
                            </div>
                            <div id="status-badge-container">
                                <!-- Badge goes here -->
                            </div>
                        </div>

                        <!-- Workflow Timeline -->
                        <div class="workflow-container">
                            <div class="workflow-steps" id="status-timeline"
                                style="display: flex; justify-content: space-between; position: relative;">
                                <!-- Dynamic Steps -->
                            </div>
                        </div>

                        <!-- Missing Sections Summary -->
                        <div id="status-missing-info"
                            style="margin-top: 3rem; padding: 1.5rem; background-color: #fff7ed; border-left: 4px solid #f97316; border-radius: 4px; display: none;">
                            <h4 style="margin: 0 0 10px; color: #c2410c; font-size: 1.1rem;">⚠️ Detalle de Presupuesto
                            </h4>
                            <p id="status-missing-text" style="margin: 0; color: #431407; line-height: 1.6;">-</p>
                        </div>
                    </div>

                    <div id="status-loading" class="hidden" style="text-align: center; margin-top: 3rem;">
                        <div style="font-size: 2rem; color: #3b82f6;">⌛</div>
                        <p style="color: #64748b; margin-top: 10px;">Buscando vehículo...</p>
                    </div>
                </div>
            </section>

            <!-- Laminado Section -->
            <section id="laminado" class="content-section hidden">
                <div class="wide-container">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="margin: 0;">Área de Laminado</h3>
                        <input type="text" id="search-laminado-active" placeholder="Buscar placa o revisión..."
                            class="search-input" onkeyup="filterTable('laminado-table-body', this.value)">
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Placa</th>
                                    <th>Vehículo</th>
                                    <th>Color</th>
                                    <th>Fecha Ingreso</th>
                                    <th>Status Pres.</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="laminado-table-body">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>

                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-top: 40px; margin-bottom: 20px;">
                        <h3 style="margin: 0;">Historial de Laminado</h3>
                        <input type="text" id="search-laminado-history" placeholder="Buscar placa..."
                            class="search-input" onkeyup="filterTable('laminado-history-body', this.value)">
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Placa</th>
                                    <th>Vehículo</th>
                                    <th>Color</th>
                                    <th>Entrada</th>
                                    <th>Usuario Entrada</th>
                                    <th>Salida</th>
                                    <th>Usuario Salida</th>
                                </tr>
                            </thead>
                            <tbody id="laminado-history-body">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Pintura Section -->
            <section id="pintura" class="content-section hidden">
                <div class="wide-container">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="margin: 0;">Área de Pintura</h3>
                        <input type="text" id="search-pintura-active" placeholder="Buscar placa o revisión..."
                            class="search-input" onkeyup="filterTable('pintura-table-body', this.value)">
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Placa</th>
                                    <th>Vehículo</th>
                                    <th>Color</th>
                                    <th>Fecha Ingreso</th>
                                    <th>Status Pres.</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="pintura-table-body">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>

                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-top: 50px; margin-bottom: 20px;">
                        <h3 style="margin: 0;">Historial de Pintura</h3>
                        <input type="text" id="search-pintura-history" placeholder="Buscar placa..."
                            class="search-input" onkeyup="filterTable('pintura-history-body', this.value)">
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Placa</th>
                                    <th>Vehículo</th>
                                    <th>Color</th>
                                    <th>Entrada</th>
                                    <th>Usuario Entrada</th>
                                    <th>Salida</th>
                                    <th>Usuario Salida</th>
                                </tr>
                            </thead>
                            <tbody id="pintura-history-body">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Salida Section -->
            <section id="salida-view" class="content-section hidden">
                <div class="wide-container" style="max-width: 800px; margin: 0 auto;">
                    <div style="text-align: center; margin-bottom: 30px;">
                        <h2>Salida de Vehículo</h2>
                        <p style="color: #666;">Busca por placa o número de revisión para registrar la salida.</p>

                        <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
                            <input type="text" id="salida-search-input" placeholder="Placa o ID de Revisión"
                                style="padding: 12px; width: 300px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px;">
                            <button class="btn-primary" onclick="performSalidaSearch()">Buscar</button>
                        </div>
                        <p id="salida-error-msg" style="color: red; display: none; margin-top: 10px;"></p>
                    </div>

                    <!-- Result Card (Hidden by default) -->
                    <div id="salida-result-card" class="card hidden"
                        style="background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                        <div
                            style="display: flex; justify-content: space-between; align-items: start; border-bottom: 2px solid #f3f4f6; padding-bottom: 15px; margin-bottom: 20px;">
                            <div>
                                <h2 id="salida-plate" style="margin: 0; color: #111827; font-size: 24px;"></h2>
                                <p id="salida-desc" style="margin: 5px 0 0 0; color: #6b7280;"></p>
                            </div>
                            <span id="salida-status-badge" class="badge"></span>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                            <div>
                                <h4 style="color: #374151; margin-bottom: 10px;">Información del Vehículo</h4>
                                <p><strong>Color:</strong> <span id="salida-color"></span></p>
                                <p><strong>Año:</strong> <span id="salida-year"></span></p>
                                <p><strong>VIN:</strong> <span id="salida-vin"></span></p>
                                <p><strong>KM:</strong> <span id="salida-km"></span></p>
                            </div>
                            <div>
                                <h4 style="color: #374151; margin-bottom: 10px;">Cliente</h4>
                                <p><strong>Nombre:</strong> <span id="salida-owner"></span></p>
                                <p><strong>Teléfono:</strong> <span id="salida-phone"></span></p>
                            </div>
                        </div>

                        <!-- Payment Field -->
                        <div style="margin-bottom: 20px;">
                            <label for="salida-pago"
                                style="display: block; font-weight: bold; margin-bottom: 5px; color: #374151;">Pago /
                                Observaciones de Cobro</label>
                            <input type="text" id="salida-pago" class="form-control"
                                placeholder="Ej: Pagado completado, Pendiente $500, Transferencia..."
                                style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px;">
                        </div>

                        <div
                            style="background: #fdf2f2; padding: 15px; border-radius: 8px; border-left: 4px solid #ef4444; margin-bottom: 20px;">
                            <p style="margin: 0; color: #991b1b;"><strong>Confirmación de Salida:</strong> Al confirmar,
                                el vehículo cambiará a estatus "Entregado" y el proceso se cerrará.</p>
                        </div>

                        <div style="text-align: right;">
                            <button class="btn-primary"
                                style="background-color: #ef4444; font-size: 16px; padding: 12px 24px;"
                                onclick="confirmSalidaTransaction()">
                                CONFIRMAR SALIDA
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Revision Section -->
            <section id="revision" class="content-section hidden">
                <div class="form-container">
                    <h3>Nueva Revisión</h3>
                    <form id="revision-form">
                        <div class="form-group">
                            <label for="rev_plate">Placa</label>
                            <input type="text" id="rev_plate" name="plate" required>
                        </div>
                        <div class="form-group">
                            <label for="rev_brand">Marca</label>
                            <input type="text" id="rev_brand" name="brand" placeholder="Ej: VW, Nissan..." required>
                        </div>
                        <div class="form-group">
                            <label for="rev_model">Modelo</label>
                            <input type="text" id="rev_model" name="model" placeholder="Ej: Jetta, Versa..." required>
                        </div>
                        <div class="form-group">
                            <label for="rev_year">Año</label>
                            <input type="number" id="rev_year" name="year" placeholder="Ej: 2023" required>
                        </div>
                        <div class="form-group">
                            <label for="rev_color">Color</label>
                            <input type="text" id="rev_color" name="color">
                        </div>
                        <div class="form-group">
                            <label for="rev_kilometers">Kilometraje</label>
                            <input type="number" id="rev_kilometers" name="kilometers" placeholder="Ej: 50000">
                        </div>
                        <div class="form-group">
                            <label for="rev_serial_number">No. de Serie (VIN)</label>
                            <input type="text" id="rev_serial_number" name="serial_number" placeholder="Ej: 3N1AB...">
                        </div>
                        <div class="form-group">
                            <label for="rev_fuel_level">Nivel de Combustible</label>
                            <select id="rev_fuel_level" name="fuel_level"
                                style="width: 100%; padding: 8px; border: 1px solid #cbd5e1; border-radius: 6px;">
                                <option value="">Seleccionar...</option>
                                <option value="Reserva">Reserva</option>
                                <option value="1/4">1/4</option>
                                <option value="1/2">1/2</option>
                                <option value="3/4">3/4</option>
                                <option value="Lleno">Lleno</option>
                            </select>
                        </div>

                        <!-- Customer Info Revision -->
                        <div class="form-group">
                            <label for="rev_owner_name">Nombre del Dueño</label>
                            <input type="text" id="rev_owner_name" name="owner_name" required>
                        </div>
                        <div class="form-group">
                            <label for="rev_contact_phone">Teléfono de Contacto</label>
                            <input type="tel" id="rev_contact_phone" name="contact_phone" required>
                        </div>
                        <div class="form-group">
                            <label for="rev_email">Correo Electrónico</label>
                            <input type="email" id="rev_email" name="email" required>
                        </div>
                        <div class="form-group">
                            <label for="rev_rfc">RFC (Opcional)</label>
                            <input type="text" id="rev_rfc" name="rfc">
                        </div>

                        <!-- Insurance Toggle Revision -->
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="rev_is_insurance" name="is_insurance">
                                ¿Entra por Seguro?
                            </label>
                        </div>

                        <!-- Conditional Fields Revision -->
                        <div id="rev-insurance-fields" class="hidden">
                            <div class="form-group">
                                <label for="rev_insurance_company">Compañía Aseguradora</label>
                                <input type="text" id="rev_insurance_company" name="insurance_company"
                                    placeholder="Ej: Qualitas, AXA...">
                            </div>
                            <div class="form-group">
                                <label for="rev_policy_number">No. de Póliza</label>
                                <input type="text" id="rev_policy_number" name="policy_number"
                                    placeholder="Ej: 123456789">
                            </div>
                            <div class="form-group">
                                <label for="rev_entry_reason">Motivo de Ingreso</label>
                                <textarea id="rev_entry_reason" name="entry_reason" rows="3"
                                    placeholder="Descripción del siniestro o reparación..."></textarea>
                            </div>
                        </div>

                        <button type="submit" class="btn-primary" style="background-color: #059669;">Crear
                            Revisión</button>
                    </form>
                </div>
            </section>
            <!-- Pagos View -->
            <div id="pagos-view" class="content-section hidden">
                <div style="max-width: 900px; margin: 0 auto;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <h2 style="color: #1f2937;">Módulo de Pagos</h2>
                        <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
                            <input type="text" id="pagos-search-input" placeholder="Placa o ID de Revisión"
                                style="padding: 12px; width: 300px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px;">
                            <button class="btn-primary" onclick="searchPagosVehicle()">Buscar</button>
                        </div>
                        <p id="pagos-error-msg"
                            style="color: #ef4444; font-weight: bold; margin-top: 15px; display: none;"></p>
                    </div>

                    <!-- Payment Dashboard (Hidden) -->
                    <div id="pagos-dashboard" class="hidden">
                        <!-- Summary Cards -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div class="card" style="text-align: center;">
                                <h4 style="color: #6b7280; font-size: 0.9em;">Total Presupuesto</h4>
                                <p id="pagos-total-est" style="font-size: 1.5em; font-weight: bold; color: #111827;">
                                    $0.00</p>
                            </div>
                            <div class="card" style="text-align: center;">
                                <h4 style="color: #6b7280; font-size: 0.9em;">Total Pagado</h4>
                                <p id="pagos-total-paid" style="font-size: 1.5em; font-weight: bold; color: #10b981;">
                                    $0.00</p>
                            </div>
                            <div class="card" style="text-align: center;">
                                <h4 style="color: #6b7280; font-size: 0.9em;">Saldo Pendiente</h4>
                                <p id="pagos-balance" style="font-size: 1.5em; font-weight: bold; color: #ef4444;">$0.00
                                </p>
                            </div>
                        </div>

                        <!-- Main Content Grid -->
                        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px;">
                            <!-- History -->
                            <div class="card">
                                <h3>Historial de Pagos</h3>
                                <table style="width: 100%; border-collapse: collapse;">
                                    <thead>
                                        <tr style="text-align: left; border-bottom: 1px solid #eee;">
                                            <th style="padding: 8px;">Fecha</th>
                                            <th style="padding: 8px;">Método</th>
                                            <th style="padding: 8px;">Nota</th>
                                            <th style="padding: 8px; text-align: right;">Monto</th>
                                        </tr>
                                    </thead>
                                    <tbody id="pagos-history-body"></tbody>
                                </table>
                            </div>

                            <!-- Register Form -->
                            <div class="card" style="background-color: #f0fdf4; border: 1px solid #bbf7d0;">
                                <h3 style="color: #166534;">Registrar Nuevo Pago</h3>
                                <div class="form-group">
                                    <label>Monto</label>
                                    <input type="number" id="pay-amount" placeholder="0.00"
                                        style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                </div>
                                <div class="form-group">
                                    <label>Método</label>
                                    <select id="pay-method"
                                        style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                        <option value="Efectivo">Efectivo</option>
                                        <option value="Tarjeta">Tarjeta</option>
                                        <option value="Transferencia">Transferencia</option>
                                        <option value="Cheque">Cheque</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Notas</label>
                                    <input type="text" id="pay-notes" placeholder="Ref/Comentarios"
                                        style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                </div>
                                <button class="btn-primary" style="width: 100%; background-color: #166534;"
                                    onclick="registerPayment()">Registrar Pago</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Approval Modal -->
    <div id="approval-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Autorizar Presupuesto</h3>
                <span class="close-modal" id="btn-close-modal">&times;</span>
            </div>
            <div class="modal-body">
                <div class="approval-instructions">
                    Selecciona los conceptos que el cliente ha autorizado:
                </div>
                <div id="approval-items-list" class="approval-items-container">
                    <!-- Items populated by JS -->
                </div>

                <div class="approval-summary">
                    <div class="summary-row">
                        <span>Total Autorizado:</span>
                        <span class="summary-amount">$<span id="approval-total">0.00</span></span>
                    </div>
                </div>

                <div class="form-group" style="margin-top: 15px;">
                    <label for="approval-notes">Notas de Aprobación</label>
                    <textarea id="approval-notes" class="approval-notes-area" rows="3"
                        placeholder="Ej: Cliente autoriza todo excepto pintura..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="btn-cancel-approval"
                    onclick="document.getElementById('approval-modal').classList.add('hidden')">Cancelar</button>
                <button class="btn-primary" id="btn-confirm-approval">Autorizar</button>
            </div>
        </div>
    </div>

    <!-- Schedule Modal -->
    <div id="schedule-modal" class="modal hidden">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3>Agendar Cita</h3>
                <span class="close-modal" id="btn-close-schedule">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="schedule-date">Fecha de Cita</label>
                    <input type="date" id="schedule-date"
                        style="width: 100%; padding: 8px; border: 1px solid #cbd5e1; border-radius: 4px;">
                </div>
                <div class="form-group">
                    <label for="schedule-revision-id">ID de Revisión</label>
                    <input type="text" id="schedule-revision-id" placeholder="Ej: ENE-VW-1234"
                        style="width: 100%; padding: 8px; border: 1px solid #cbd5e1; border-radius: 4px;">
                </div>
                <div class="form-group">
                    <label for="schedule-time">Hora de Ingreso (Max 6:00 PM)</label>
                    <input type="time" id="schedule-time"
                        style="width: 100%; padding: 8px; border: 1px solid #cbd5e1; border-radius: 4px;">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary"
                    onclick="document.getElementById('schedule-modal').classList.add('hidden')">Cancelar</button>
                <button class="btn-primary" id="btn-confirm-schedule">Agendar</button>
            </div>
        </div>
    </div>

    <!-- Event Details Modal -->
    <div id="event-details-modal" class="modal hidden">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3>Detalles de la Cita</h3>
                <span class="close-modal" id="btn-close-details">&times;</span>
            </div>
            <div class="modal-body" id="event-details-body" style="line-height: 1.6;">
                <input type="hidden" id="det-revision-id">
                <p><strong>Vehículo:</strong> <span id="det-vehicle"></span></p>
                <p><strong>Placa:</strong> <span id="det-plate"></span></p>
                <p><strong>Color:</strong> <span id="det-color"></span></p>
                <p><strong>Dueño:</strong> <span id="det-owner"></span></p>
                <p><strong>Teléfono:</strong> <span id="det-phone"></span></p>
                <p><strong>Fecha Programada:</strong> <span id="det-date"></span></p>
                <div style="margin-top: 10px; background: #f8fafc; padding: 10px; border-radius: 4px;">
                    <strong>Motivo de Ingreso:</strong>
                    <p id="det-reason" style="margin: 5px 0 0 0; color: #475569;"></p>
                </div>
            </div>
            <div class="modal-footer" style="display: flex; justify-content: space-between;">
                <button class="btn-primary" style="background-color: #ef4444;" id="btn-cancel-appt">Cancelar</button>
                <div style="display: flex; gap: 10px;">
                    <button class="btn-primary" style="background-color: #f59e0b;"
                        id="btn-reschedule-appt">Reagendar</button>
                    <button class="btn-primary" style="background-color: #10b981;"
                        id="btn-checkin-appt">Ingreso</button>
                    <button class="btn-primary"
                        onclick="document.getElementById('event-details-modal').classList.add('hidden')">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Vehicle Details Modal -->
    <div id="vehicle-details-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Detalles del Vehículo</h2>
                <span class="close-modal" onclick="closeModal('vehicle-details-modal')">&times;</span>
            </div>
            <div class="modal-body">
                <div class="details-grid">
                    <div class="details-section">
                        <h3>Información del Vehículo</h3>
                        <p><strong>Placa:</strong> <span id="veh-detail-plate"></span></p>
                        <p><strong>Marca/Modelo:</strong> <span id="veh-detail-brand-model"></span></p>
                        <p><strong>Año:</strong> <span id="veh-detail-year"></span></p>
                        <p><strong>Color:</strong> <span id="veh-detail-color"></span></p>
                        <p><strong>Motivo:</strong> <span id="veh-detail-reason"></span></p>
                    </div>
                    <div class="details-section">
                        <h3>Propietario</h3>
                        <p><strong>Nombre:</strong> <span id="veh-detail-owner"></span></p>
                        <p><strong>Teléfono:</strong> <span id="veh-detail-phone"></span></p>
                    </div>
                    <div class="details-section full-width">
                        <h3>Estado y Presupuesto</h3>
                        <div class="status-card">
                            <p><strong>Estatus Actual:</strong> <span id="veh-detail-status"
                                    class="status-badge"></span></p>
                            <div id="veh-estimate-info" class="mt-2 hidden">
                                <p><strong>ID Revisión:</strong> <span id="veh-rev-code"></span></p>
                                <p><strong>Presupuesto Generado:</strong> <span id="veh-est-total"
                                        class="money-text"></span></p>
                                <p><strong>Estatus Cotización:</strong> <span id="veh-est-status" class="badge"></span>
                                </p>
                            </div>
                            <div id="veh-no-estimate" class="mt-2 text-gray">
                                <em>No hay cotización generada aún.</em>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Repair Categories Accordion -->
            <div id="repair-accordions" class="accordion-container mt-4 hidden">
                <h3 style="margin-bottom: 1rem; color: var(--text-primary);">Detalle de Reparaciones</h3>

                <!-- Pintura -->
                <div class="accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion('acc-pintura')">
                        <span>Pintura</span>
                        <span class="arrow">▼</span>
                    </div>
                    <div id="acc-pintura" class="accordion-content hidden">
                        <p class="text-gray-500 italic">Sin items</p>
                    </div>
                </div>

                <!-- Laminado -->
                <div class="accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion('acc-laminado')">
                        <span>Laminado</span>
                        <span class="arrow">▼</span>
                    </div>
                    <div id="acc-laminado" class="accordion-content hidden">
                        <p class="text-gray-500 italic">Sin items</p>
                    </div>
                </div>

                <!-- Cristales -->
                <div class="accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion('acc-cristales')">
                        <span>Cristales</span>
                        <span class="arrow">▼</span>
                    </div>
                    <div id="acc-cristales" class="accordion-content hidden">
                        <p class="text-gray-500 italic">Sin items</p>
                    </div>
                </div>

                <!-- Eléctrico -->
                <div class="accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion('acc-electrico')">
                        <span>Eléctrico</span>
                        <span class="arrow">▼</span>
                    </div>
                    <div id="acc-electrico" class="accordion-content hidden">
                        <p class="text-gray-500 italic">Sin items</p>
                    </div>
                </div>

                <!-- Motor -->
                <div class="accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion('acc-motor')">
                        <span>Motor</span>
                        <span class="arrow">▼</span>
                    </div>
                    <div id="acc-motor" class="accordion-content hidden">
                        <p class="text-gray-500 italic">Sin items</p>
                    </div>
                </div>

                <!-- Extras -->
                <div class="accordion-item">
                    <div class="accordion-header" onclick="toggleAccordion('acc-extras')">
                        <span>Extras</span>
                        <span class="arrow">▼</span>
                    </div>
                    <div id="acc-extras" class="accordion-content hidden">
                        <p class="text-gray-500 italic">Sin items</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal('vehicle-details-modal')">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Pagos View -->
    <div id="pagos-view" class="content-section hidden">
        <div style="max-width: 900px; margin: 0 auto;">
            <div style="text-align: center; margin-bottom: 20px;">
                <h2 style="color: #1f2937;">Módulo de Pagos</h2>
                <div style="display: flex; gap: 10px; justify-content: center; margin-top: 20px;">
                    <input type="text" id="pagos-search-input" placeholder="Placa o ID de Revisión"
                        style="padding: 12px; width: 300px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px;">
                    <button class="btn-primary" onclick="searchPagosVehicle()">Buscar</button>
                </div>
                <p id="pagos-error-msg" style="color: #ef4444; font-weight: bold; margin-top: 15px; display: none;"></p>
            </div>

            <!-- Payment Dashboard (Hidden) -->
            <div id="pagos-dashboard" class="hidden">
                <!-- Summary Cards -->
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div class="card" style="text-align: center;">
                        <h4 style="color: #6b7280; font-size: 0.9em;">Total Presupuesto</h4>
                        <p id="pagos-total-est" style="font-size: 1.5em; font-weight: bold; color: #111827;">$0.00</p>
                    </div>
                    <div class="card" style="text-align: center;">
                        <h4 style="color: #6b7280; font-size: 0.9em;">Total Pagado</h4>
                        <p id="pagos-total-paid" style="font-size: 1.5em; font-weight: bold; color: #10b981;">$0.00</p>
                    </div>
                    <div class="card" style="text-align: center;">
                        <h4 style="color: #6b7280; font-size: 0.9em;">Saldo Pendiente</h4>
                        <p id="pagos-balance" style="font-size: 1.5em; font-weight: bold; color: #ef4444;">$0.00</p>
                    </div>
                </div>

                <!-- Main Content Grid -->
                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px;">
                    <!-- History -->
                    <div class="card">
                        <h3>Historial de Pagos</h3>
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="text-align: left; border-bottom: 1px solid #eee;">
                                    <th style="padding: 8px;">Fecha</th>
                                    <th style="padding: 8px;">Método</th>
                                    <th style="padding: 8px;">Nota</th>
                                    <th style="padding: 8px; text-align: right;">Monto</th>
                                </tr>
                            </thead>
                            <tbody id="pagos-history-body"></tbody>
                        </table>
                    </div>

                    <!-- Register Form -->
                    <div class="card" style="background-color: #f0fdf4; border: 1px solid #bbf7d0;">
                        <h3 style="color: #166534;">Registrar Nuevo Pago</h3>
                        <div class="form-group">
                            <label>Monto</label>
                            <input type="number" id="pay-amount" placeholder="0.00"
                                style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <div class="form-group">
                            <label>Método</label>
                            <select id="pay-method"
                                style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="Efectivo">Efectivo</option>
                                <option value="Tarjeta">Tarjeta</option>
                                <option value="Transferencia">Transferencia</option>
                                <option value="Cheque">Cheque</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Notas</label>
                            <input type="text" id="pay-notes" placeholder="Ref/Comentarios"
                                style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        </div>
                        <button class="btn-primary" style="width: 100%; background-color: #166534;"
                            onclick="registerPayment()">Registrar Pago</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Revision Full Details Modal -->
    <div id="revision-details-modal" class="modal hidden">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3>Detalles de la Revisión</h3>
                <span class="close-modal"
                    onclick="document.getElementById('revision-details-modal').classList.add('hidden')">&times;</span>
            </div>
            <div class="modal-body" style="padding: 20px;">
                <div class="info-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <!-- Section 1: Vehicle Info -->
                    <div style="background: #f8fafc; padding: 15px; border-radius: 8px;">
                        <h4
                            style="margin-top: 0; color: #2563eb; border-bottom: 1px solid #e2e8f0; padding-bottom: 8px;">
                            Información del Vehículo</h4>
                        <p><strong>Código Revisión:</strong> <span id="view-rev-code"></span></p>
                        <p><strong>Placa:</strong> <span id="view-plate"></span></p>
                        <p><strong>Marca/Modelo:</strong> <span id="view-brand-model"></span></p>
                        <p><strong>Año:</strong> <span id="view-year"></span></p>
                        <p><strong>Color:</strong> <span id="view-color"></span></p>
                        <p><strong>VIN:</strong> <span id="view-serial"></span></p>
                        <p><strong>Kilometraje:</strong> <span id="view-km"></span></p>
                        <p><strong>Nivel Combustible:</strong> <span id="view-fuel"></span></p>
                    </div>

                    <!-- Section 2: Owner Info -->
                    <div style="background: #f8fafc; padding: 15px; border-radius: 8px;">
                        <h4
                            style="margin-top: 0; color: #2563eb; border-bottom: 1px solid #e2e8f0; padding-bottom: 8px;">
                            Información del Dueño</h4>
                        <p><strong>Nombre:</strong> <span id="view-owner"></span></p>
                        <p><strong>Teléfono:</strong> <span id="view-phone"></span></p>
                        <p><strong>Email:</strong> <span id="view-email"></span></p>
                        <p><strong>RFC:</strong> <span id="view-rfc"></span></p>
                    </div>
                </div>

                <!-- Section 3: Insurance & Reason -->
                <div style="margin-top: 20px; background: #f8fafc; padding: 15px; border-radius: 8px;">
                    <h4 style="margin-top: 0; color: #2563eb; border-bottom: 1px solid #e2e8f0; padding-bottom: 8px;">
                        Detalles de Ingreso</h4>

                    <div id="view-insurance-section" class="hidden"
                        style="margin-bottom: 15px; background: #dbeafe; padding: 10px; border-radius: 4px;">
                        <p style="margin: 0;"><strong>⚠️ RECLAMO DE SEGURO</strong></p>
                        <p style="margin: 5px 0;"><strong>Aseguradora:</strong> <span
                                id="view-insurance-company"></span></p>
                        <p style="margin: 5px 0;"><strong>Póliza:</strong> <span id="view-policy"></span></p>
                    </div>

                    <div>
                        <strong>Motivo de Ingreso:</strong>
                        <p id="view-reason"
                            style="background: white; padding: 10px; border: 1px solid #e2e8f0; border-radius: 4px; margin-top: 5px; min-height: 60px;">
                        </p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-primary"
                    onclick="document.getElementById('revision-details-modal').classList.add('hidden')">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmation-modal" class="modal hidden">
        <div class="modal-content" style="max-width: 400px; text-align: center;">
            <h3 id="conf-modal-title" style="margin-bottom: 1rem;">Confirmación</h3>
            <p id="conf-modal-msg" style="margin-bottom: 2rem;">¿Estás seguro?</p>
            <div style="display: flex; gap: 10px; justify-content: center;">
                <button class="btn-secondary" onclick="closeModal('confirmation-modal')">Cancelar</button>
                <button id="conf-modal-btn" class="btn-primary">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- View Notes Modal -->
    <div id="view-notes-modal" class="modal hidden">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3>Notas de Aprobación</h3>
                <span class="close-modal"
                    onclick="document.getElementById('view-notes-modal').classList.add('hidden')">&times;</span>
            </div>
            <div class="modal-body" style="padding: 20px;">
                <div
                    style="background: #f8fafc; padding: 15px; border-radius: 8px; border: 1px solid #e2e8f0; min-height: 80px;">
                    <p id="view-notes-content"
                        style="white-space: pre-wrap; margin: 0; color: #334155; line-height: 1.5;"></p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-primary"
                    onclick="document.getElementById('view-notes-modal').classList.add('hidden')">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Capacity Config Modal -->
    <div id="capacity-modal" class="modal hidden" style="z-index: 2000;">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3>Configurar Capacidad Diaria</h3>
                <span class="close-modal" onclick="closeCapacityModal()">&times;</span>
            </div>
            <div class="modal-body" style="padding: 20px;">
                <p id="cap-modal-date" style="margin-bottom: 15px; font-weight: bold; color: #64748b;"></p>
                <div class="form-group">
                    <label>Capacidad Máxima de Vehículos</label>
                    <input type="number" id="cap-input" class="form-control" min="1" value="20">
                    <p style="font-size: 0.8em; color: #94a3b8; margin-top: 5px;">Por defecto es 20.</p>
                </div>
                <div class="form-group" style="margin-top: 15px; display: flex; align-items: center; gap: 10px;">
                    <input type="checkbox" id="cap-closed-input" style="width: 18px; height: 18px;">
                    <label for="cap-closed-input" style="margin: 0; font-weight: 500; cursor: pointer;">Día Inhábil
                        (Cerrado)</label>
                </div>
                <p id="cap-closed-warning" style="font-size: 0.8em; color: #ef4444; margin-top: 5px; display: none;">No
                    se puede cerrar el día porque existen citas agendadas.</p>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeCapacityModal()">Cancelar</button>
                <button class="btn-primary" onclick="saveCapacity()">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Warning Reschedule Modal -->
    <div id="warning-reschedule-modal" class="modal hidden" style="z-index: 2100;">
        <div class="modal-content" style="max-width: 450px; border-top: 5px solid #ef4444;">
            <div class="modal-header">
                <h3 style="color: #ef4444;">Acción Requerida</h3>
                <span class="close-modal"
                    onclick="document.getElementById('warning-reschedule-modal').classList.add('hidden')">&times;</span>
            </div>
            <div class="modal-body" style="padding: 25px; text-align: center;">
                <div style="font-size: 40px; margin-bottom: 15px;">⚠️</div>
                <h4 style="margin-bottom: 10px; color: #1e293b;">Citas Agendadas Detectadas</h4>
                <p style="color: #64748b; line-height: 1.6;">
                    No es posible marcar este día como inhábil porque existen citas agendadas.
                    <br><br>
                    <strong>Por favor, reagende las citas existentes para poder proceder.</strong>
                </p>
            </div>
            <div class="modal-footer" style="justify-content: center;">
                <button class="btn-primary"
                    onclick="document.getElementById('warning-reschedule-modal').classList.add('hidden')">Entendido</button>
            </div>
        </div>
    </div>

    <!-- Generic Alert Modal -->
    <div id="alert-modal" class="modal hidden" style="z-index: 3000;">
        <div class="modal-content" style="max-width: 400px; text-align: center;">
            <div class="modal-header" style="justify-content: center; border-bottom: none; padding-bottom: 0;">
                <div style="font-size: 40px;">⚠️</div>
            </div>
            <div class="modal-body" style="padding: 10px 25px 25px;">
                <h3 id="alert-modal-title" style="margin-top: 0; color: #1e293b;">Atención</h3>
                <p id="alert-modal-msg" style="color: #64748b; line-height: 1.5;"></p>
            </div>
            <div class="modal-footer" style="justify-content: center; padding-top: 0; border-top: none;">
                <button class="btn-primary"
                    onclick="document.getElementById('alert-modal').classList.add('hidden')">Aceptar</button>
            </div>
        </div>
    </div>

    <!-- Daily Summary Modal -->
    <div id="daily-summary-modal" class="modal hidden" style="z-index: 3000;">
        <div class="modal-content" style="max-width: 600px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 id="summary-modal-title" style="margin: 0; color: #1e293b;">Vehículos Ingresados</h3>
                <span class="close-modal" onclick="closeDailySummary()"
                    style="cursor: pointer; font-size: 1.5rem;">&times;</span>
            </div>
            <div class="table-container" style="max-height: 400px; overflow-y: auto; box-shadow: none; padding: 0;">
                <table style="width: 100%; border-collapse: collapse;">
                    <thead style="position: sticky; top: 0; background: white;">
                        <tr>
                            <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e2e8f0;">Placa</th>
                            <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e2e8f0;">Vehículo</th>
                            <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e2e8f0;">Usuario</th>
                        </tr>
                    </thead>
                    <tbody id="summary-modal-body">
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>
            <div style="margin-top: 20px; text-align: right; padding-top: 12px; border-top: 1px solid #e2e8f0;">
                <button class="btn-primary" onclick="closeDailySummary()">Cerrar</button>
            </div>
        </div>
    </div>

    <script src="js/app.js?v=24"></script>
</body>

</html>